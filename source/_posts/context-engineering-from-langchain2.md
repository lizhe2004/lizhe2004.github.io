---
title: "上下文工程"的兴起（翻译自langchain博客）
toc: true
date: 2025-07-07
tags: [Context Engineering,上下文工程,大模型,Agent,智能体]
categories: [人工智能]
description: langchain 关于Context Engineering的理解和介绍，主要包括上下文工程的定义、构成要素以及技术策略
banner: https://cdn.jsdmirror.com/gh/lizhe2004/pic-repo@master//imgs/20250707154223.png
cover: https://cdn.jsdmirror.com/gh/lizhe2004/pic-repo@master//imgs/20250707154223.png
author: 李大侠
breadcrumb: true
leftbar:
  - recent
  - related
  - tagcloud
rightbar:
  - toc
---
原文 链接：https://blog.langchain.com/the-rise-of-context-engineering/

# "上下文工程"的兴起
 
 
上下文工程是指构建动态系统，以正确的格式提供正确的信息和工具，使LLM能够合理完成任务。

当智能体表现不可靠时，大多数情况的根本原因是没有向模型传递适当的上下文、指令和工具。

大模型应用正在从单一提示演变为更复杂、动态的智能体系统。因此，上下文工程正在成为[AI工程师要提升的最重要技能](https://cognition.ai/blog/dont-build-multi-agents?ref=blog.langchain.com#a-theory-of-building-long-running-agents)。

## 什么是上下文工程？

> Context engineering is building dynamic systems to provide the right information and tools in the right format such that the LLM can plausibly accomplish the task.

上下文工程是指构建动态系统，以正确的格式提供正确的信息和工具，使LLM能够合理完成任务。

这是我喜欢的一个定义，它建立在电子商务平台Shopify公司的CEO[Tobi Lutke](https://x.com/tobi/status/1935533422589399127?ref=blog.langchain.com)、专注于AI应用开发的Braintrust公司的的CEO[Ankur Goyal](https://x.com/ankrgyl/status/1913766591910842619?ref=blog.langchain.com)和开发了全球首个自主 AI 程序员 Devin的Cognition AI公司的联合创始人兼首席产品官（CPO）[Walden Yan](https://cognition.ai/blog/dont-build-multi-agents?ref=blog.langchain.com)最近的观点之上。让我们分解一下。
![20250707155959](https://cdn.jsdmirror.com/gh/lizhe2004/pic-repo@master//imgs/20250707155959.png)
![20250711143712](https://cdn.jsdmirror.com/gh/lizhe2004/pic-repo@master//imgs/20250711143712.png)
### 上下文工程是一个系统
复杂的智能体可能会从多个来源来获取上下文。上下文可以来自应用的开发人员、用户、先前的交互、工具调用或其他外部数据。将这些全部整合在一起需要一个复杂的系统。

### 系统是动态的
上下文的许多片段是可以动态地出现的。因此，构建最终提示的逻辑也需要是动态的。它不仅仅是一个静态提示。

### 需要正确的信息
智能体系统表现不佳的一个常见原因是它们没有正确的上下文。LLM不能读心术——你需要给它们正确的信息。垃圾进，垃圾出（Garbage in, garbage out）。

### 你需要正确的工具
LLM并不总是能够仅基于用户输入的内容解决问题。在这些情况下，如果你想授权LLM这样做，你需要确保它有正确的工具。这些工具可以是查找更多信息的工具、业可以是执行某些动作的工具，还可以是介于两者之间的工具。给LLM提供正确的工具和给它提供正确的信息同样重要。

### 格式很重要
就像与人交流一样，如何与LLM交流也很重要。一个简短但描述性的错误信息比一个大的JSON更有用。这也适用于工具。工具的输入参数在确保LLM可以使用它们时非常重要。

### 它能顺利完成任务吗？
在思考上下文工程时，这是一个很好的问题。它强化了一点认知， 也就是LLM并不具备读心术——我们需要为它们创造成功的条件和环境。这也有助于我们区别失败的情况。是因为没有给它正确的信息或工具而失败，还是因为它拥有所有正确的信息但还是搞砸了？这些不同的失败情况的修复方法大相径庭，各不相同。
## 为什么上下文工程很重要
当智能体系统出错时，很大程度上是因为LLM出错了。从第一性原理思考，LLM出错有两个原因：

1. 底层模型出错了，它不够好
2. 底层模型没有接收到合适的上下文来生成好的输出结果。

更多时候（尤其是随着模型越来越好），模型错误更多是由第二个原因引起的。传递给模型的上下文可能存在以下几种问题：
- 缺少模型做出正确决策所需的上下文。模型不会读心术。如果我们不给它们提供正确的上下文，它们就不会知道这些内容的存在。
- 上下文格式不好。就像人类一样，沟通很重要！在将数据传递给模型时，如何进行格式化绝对会影响模型的响应方式。

## 上下文工程与提示工程有何不同？
为什么从"提示（Prompt）"转向"上下文（Context）"？早期，开发人员专注于设计巧妙的措辞提示来获得更好的答案。但随着应用变得越来越复杂，人们逐渐意识到，为AI提供完整和结构化的上下文比任何神奇的措辞都重要得多。

我还认为提示工程是上下文工程的一个子集。即使拥有所有的上下文信息，如何在提示中组装这些信息仍然非常重要。不同之处在于，我们设计提示词不是为了更好地配合某一个或一组输入数据，而是要处理动态数据集并将其正确格式化。

我还想强调，上下文的一个关键部分通常是LLM应该如何行动的核心指令。这通常是提示工程的关键部分。有人可能会问，告诉智能体应该如何行动所提供的清晰详细的指令是上下文工程还是提示工程？我认为两者兼而有之。

## 上下文工程的例子
一些好的上下文工程的简单示例包括：
- 工具使用：确保如果智能体需要访问外部信息，它有可以访问的工具。当工具返回信息时，它们以LLM最容易理解的方式格式化。
- 短期记忆：如果对话持续一段时间，创建对话摘要并在将来使用它。
- 长期记忆：如果用户在之前的对话中表达了偏好，能够获取该信息。
- 提示工程：关于智能体应该如何行动的指令在提示中明确列出。
- 检索：动态获取信息并在调用LLM之前将其插入提示中。

### LangGraph如何实现上下文工程
当我们构建LangGraph时，我们的目标是将其打造成最可控的智能体框架。这也使它能够完美地实现上下文工程。

使用LangGraph，你可以控制一切。你可以决定决定运行哪些步骤，也可以决定决定将什么内容输入到LLM，还可以决定在哪里存储输出的结果。你能够控制一切。

这使得用户可以执行任何所想要的上下文工程。智能体抽象（大多数其他智能体框架强调）的一个缺点就是它们限制了上下文工程。可能有些地方用户无法改变进入到LLM的确切内容，或者无法确切运行之前确切步骤。

旁注：Dex Horthy的《[12 Factor Agents](https://github.com/humanlayer/12-factor-agents?ref=blog.langchain.com)》是一篇非常好的读物。里面的许多观点都与上下文工程有关（ "own your prompts"、"own your context building"等）。我们非常欣赏他沟通这个领域重要性的方式。

### LangSmith如何帮助上下文工程
LangSmith是我们的LLM应用可观测性和评估解决方案。LangSmith的一个关键功能就是能够跟踪智能体调用。尽管我们在构建LangSmith时"上下文工程"这个术语还不存在，但它恰当地描述了这项追踪功能所帮助的内容。

LangSmith让用户看到智能体中发生的所有步骤。这让用户可以看到为了收集发送到 LLM 的数据而运行了哪些步骤。

LangSmith让用户可以看到LLM的确切输入和输出。这让用户确切地看到什么数据被送入了 LLM - 它拥有哪些数据以及如何进行格式化。然后可以调试这些数据是否包含了完成任务所需的所有相关信息。这包括LLM可以访问的工具——所以可以调试是否给它提供了适当的工具来帮助完成手头的任务。

### 沟通就是一切
几个月前，我写了一篇名为[《沟通就是一切》](https://blog.langchain.com/communication-is-all-you-need/)的博客。主要观点是与LLM沟通很难，而且没有得到足够的重视，这往往是许多智能体出错的根本原因。其中许多这些观点都与上下文工程有关！

上下文工程并不是一个新想法——过去一两年里，智能体的开发人员一只在做这件事。这是一个新术语，恰当地描述了一项日益重要的技能。我们将在这个主题上撰写和分享更多内容。我们认为我们构建的许多工具（LangGraph、LangSmith）都是非常适合支持上下文工程的，因此我们很兴奋地看到这一领域的重视程度正在提升。